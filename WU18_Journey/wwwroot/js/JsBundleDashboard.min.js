var app=angular.module("journeyApp",["ngRoute","ngCookies","chart.js"]);app.config(function(n){n.when("/CompleteRoadTrip/",{templateUrl:"/templates/completeRoadTrip.html",controller:"journeyController"}).when("/register/",{templateUrl:"/templates/register.html",controller:"journeyLoginController"}).when("/addVehicles/",{templateUrl:"/templates/addVehicle.html",controller:"addVehiclesController"}).when("/manageVehicles/",{templateUrl:"/templates/manageVehicles.html",controller:"manageVehiclesController"}).when("/createNewRoadtrip/",{templateUrl:"/templates/createNewRoadtrip.html",controller:"getRoadtripController"}).when("/completeRoadtrip/",{templateUrl:"/templates/completeRoadtrip.html",controller:"journeyController"}).when("/ongoingRoadtrips/",{templateUrl:"/templates/ongoingRoadtrips.html",controller:"journeyController"}).when("/support/",{templateUrl:"/templates/support.html",controller:"supportController"}).when("/rapport/",{templateUrl:"/templates/rapport.html",controller:"rapportController"}).when("/pdf/",{templateUrl:"/pdf/pdf",controller:"rapportController"}).otherwise({redirectTo:"/"})});app.controller("journeyController",function(n,t,i,r,u){i.loggedInUser=JSON.parse(u.get("loggedInUser"));navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){n.latitude=t.coords.latitude;n.longitude=t.coords.longitude;n.$apply()},function(){n.longitude=13.738671;n.latitude=57.356136}):(n.longitude=13.738671,n.latitude=57.356136);i.findAdressForDestinationComplete=function(){var t=new google.maps.Geocoder,r={lat:parseFloat(n.latitude),lng:parseFloat(n.longitude)};t.geocode({location:r},function(t){t[0]&&(i.myAdressDestinationCompleteRoadtrip=t[0].formatted_address,n.$apply())})};t.get("/api/Roadtrip/",{headers:{Authorization:"Bearer "+i.loggedInUser.CookieWithToken}}).then(function(t){n.unfinishedRoadtrips=t.data},function(){});n.completeRoadtripJsFunction=function(n){i.RoadtripId=n.roadtripId;var r="api/Roadtrip/"+i.RoadtripId;t.get(r,{headers:{Authorization:"Bearer "+i.loggedInUser.CookieWithToken}}).then(function(n){i.ongoingRoadtripToComplete=n.data.ongoingRoadtrip;i.roadtripDate=n.data.date;i.roadtripCarMake=n.data.vehicleMake;i.roadtripCarNumberPlate=n.data.vehiclePlateNumber;i.roadtripStopDestination=n.data.stopDestination;i.roadtripStartDestination=n.data.startDestination;i.roadtripNote=n.data.note;i.roadtripMatter=n.data.matter;i.roadtripMilesStart=n.data.roadtripMilesStart;i.roadtripMilesStop=n.data.roadtripMilesStop;console.log(n)},function(){})};n.completeRoadtripJsAction=function(){var r,u,f;i.ccccompleteRoadtripStopDestination=i.roadtripMilesStop;i.ccccompleteRoadtripStopDestination=i.roadtripMilesStop==0||i.roadtripMilesStop==undefined?n._RoadtripMilesStopcomplete:i.roadtripMilesStop;i.StopDestinationResolvedForPut=i.roadtripStopDestination;i.roadtripStopDestination==0||i.roadtripStopDestination=="0"||i.roadtripStopDestination==null||i.roadtripStopDestination==undefined||i.roadtripStopDestination=="undefined"?i.StopDestinationResolvedForPut=n.StopDestinationcompleteRoadtrip:(n.StopDestinationcompleteRoadtrip==0||n.StopDestinationcompleteRoadtrip=="0"||n.StopDestinationcompleteRoadtrip==null||n.StopDestinationcompleteRoadtrip==undefined||n.StopDestinationcompleteRoadtrip=="undefined")&&(i.StopDestinationResolvedForPut=i.myAdressDestinationCompleteRoadtrip);i.NoteResolvedForPutRoadtrip=i.roadtripMatter;i.roadtripMatter==0||i.roadtripMatter=="0"||i.roadtripMatter==null||i.roadtripMatter==undefined||i.roadtripMatter=="undefined"||i.roadtripMatter==""?i.MatterResolvedForPutRoadtrip=n._MattercompleteRoadtrip:(n._MattercompleteRoadtrip==0||n._MattercompleteRoadtrip=="0"||n._MattercompleteRoadtrip==null||n._MattercompleteRoadtrip==undefined||n._MattercompleteRoadtrip=="undefined"||n._MattercompleteRoadtrip=="")&&(i.NoteResolvedForPutRoadtrip=i.roadtripMatter);i.NoteResolvedForPutRoadtrip=i.roadtripNote;(i.roadtripNote==0||i.roadtripNote=="0"||i.roadtripNote==null||i.roadtripNote==undefined||i.roadtripNote=="undefined"||i.roadtripNote=="")&&(i.NoteResolvedForPutRoadtrip=n._NotecompleteRoadtrip);var e=i.roadtripDate,o=i.roadtripCarMake,s=i.roadtripCarNumberPlate,h=i.roadtripStartDestination,c=i.roadtripMilesStart;r=i.StopDestinationResolvedForPut==null||i.MatterResolvedForPutRoadtrip==undefined||i.ccccompleteRoadtripStopDestination==undefined?Boolean(JSON.parse(!0)):Boolean(JSON.parse(!1));i.StopDestinationResolvedForPut==undefined&&(StopDestination=i.myAdressDestinationCompleteRoadtrip);i.StopDestinationResolvedForPut==""&&(StopDestination=i.myAdressDestinationCompleteRoadtrip);i.myAdressDestinationCompleteRoadtrip==undefined&&(StopDestination=n.StopDestinationcompleteRoadtrip);u={RoadtripId:i.RoadtripId,Date:e,VehiclePlateNumber:s,RoadtripMilesStart:c,RoadtripMilesStop:i.ccccompleteRoadtripStopDestination,StartDestination:h,StopDestination:i.StopDestinationResolvedForPut,Matter:i.MatterResolvedForPutRoadtrip,ongoingRoadtrip:r,Note:i.NoteResolvedForPutRoadtrip,VehicleMake:o};n.roadtripSuccessfullyCompleted=Boolean(JSON.parse(!1));f="/api/Roadtrip/"+i.RoadtripId;t.put(f,u,{headers:{Authorization:"Bearer "+i.loggedInUser.CookieWithToken}}).then(function(t){n.roadtripSuccessfullyCompleted=Boolean(JSON.parse(!0));console.log(t)},function(){})}});app.controller("getRoadtripController",function(n,t,i){var r,u;navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){n.latitude=t.coords.latitude;n.longitude=t.coords.longitude;n.$apply()},function(){n.longitude=13.738671;n.latitude=57.356136}):(n.longitude=13.738671,n.latitude=57.356136);n.findAdress=function(){var t=new google.maps.Geocoder,i={lat:parseFloat(n.latitude),lng:parseFloat(n.longitude)};t.geocode({location:i},function(t){t[0]&&(n.myAdress=t[0].formatted_address,n.$apply())})};n.findAdressForDestination=function(){var t=new google.maps.Geocoder,i={lat:parseFloat(n.latitude),lng:parseFloat(n.longitude)};t.geocode({location:i},function(t){t[0]&&(n.myAdressDestination=t[0].formatted_address,n.$apply())})};i.ongoingRoadtripsExist=Boolean(JSON.parse(!1));r="/api/Roadtrip/";t.get(r,{headers:{Authorization:"Bearer "+i.loggedInUser.CookieWithToken}}).then(function(){},function(){});n.selectCarForRoadtrip=function(t){n.dropdownText=t.make+" "+t.plateNumber;i.selectedVehicleMake=t.make;i.selectedVehiclePlateNumber=t.plateNumber};n.RoadtripMilesStart=0;n.RoadtripMilesStop=0;n.createRoadtripJsAction=function(){var o,s,h;n.RoadtripMilesStart==0||n.RoadtripMilesStart==null||n.RoadtripMilesStart==""||n.RoadtripMilesStart==undefined||n.RoadtripMilesStart=="undefined"?n.startSelectError=!0:n.dateStartReport==0||n.dateStartReport==null||n.dateStartReport==""?n.startError=!0:(n.dateEndReport==0||n.dateEndReport==null||n.dateEndReport=="")&&(n.endError=!0);var c=i.selectedVehicleMake,l=i.selectedVehiclePlateNumber,a=n.dateStartPicker,v=n.RoadtripMilesStart,f=n.RoadtripMilesStop,y=n.RoadtripMilesStop-n.RoadtripMilesStart,u=n.StartDestination,r=n.StopDestination,e=n.Matter,p=n.Note;u==undefined&&(u=n.myAdress);u==""&&(u=n.myAdress);u==undefined&&(u=n.StartDestination);r==undefined&&(r=n.myAdressDestination);r==""&&(r=n.myAdressDestination);r==undefined&&(r=n.StopDestination);o=f==0||r==null||e==null?Boolean(JSON.parse(!0)):Boolean(JSON.parse(!1));s={VehicleMake:c,VehiclePlateNumber:l,Date:a,RoadtripMilesStart:v,TravelDistance:y,RoadtripMilesStop:f,StartDestination:u,StopDestination:r,Matter:e,ongoingRoadtrip:o,Note:p};n.roadtripSuccessfullyCreated=Boolean(JSON.parse(!1));n.roadtripNotCreated=Boolean(JSON.parse(!1));h="/api/Roadtrip";t.post(h,s,{headers:{Authorization:"Bearer "+i.loggedInUser.CookieWithToken}}).then(function(t){n.roadtripSuccessfullyCreated=Boolean(JSON.parse(!0));console.log(t)},function(t){var i=t.status;console.log(t,"errors: ",i,"Det finns redan pågående resor och därför returnerar jag ett fel så det inte går att posta.");n.roadtripNotCreated=Boolean(JSON.parse(!0))})};u="/api/Vehicles/";t.get(u,{headers:{Authorization:"Bearer "+i.loggedInUser.CookieWithToken}}).then(function(t){n.getAvailableVehicles=t.data.availableVehicles;angular.forEach(n.getAvailableVehicles,function(t){t.defaultVehicle==!0&&n.selectCarForRoadtrip(t)})},function(){})});app.controller("manageVehiclesController",function(n,t,i){t.get("/api/Vehicles/",{headers:{Authorization:"Bearer "+i.loggedInUser.CookieWithToken}}).then(function(t){n.getAvailableVehicles=t.data.availableVehicles},function(){});n.deleteVehicle=function(r){n.vehicleDeletedSuccessfully=Boolean(JSON.parse(!1));var u=r.vehicleId,f="/api/Vehicles/"+u;t.delete(f,{headers:{Authorization:"Bearer "+i.loggedInUser.CookieWithToken}}).then(function(){n.vehicleDeletedSuccessfully=Boolean(JSON.parse(!0))},function(){})};n.setVehicleActive=function(n){var r=n.vehicleId,u="/api/Vehicles/"+r;n.active=!0;t.put(u,n,{headers:{Authorization:"Bearer "+i.loggedInUser.CookieWithToken}}).then(function(){},function(){})};n.setVehicleInActive=function(n){var r=n.vehicleId,u="/api/Vehicles/"+r;n.active=!1;t.put(u,n,{headers:{Authorization:"Bearer "+i.loggedInUser.CookieWithToken}}).then(function(){},function(){})};n.setVehicleStandard=function(n){var r=n.vehicleId,u="/api/Vehicles/"+r;n.defaultVehicle=!0;t.put(u,n,{headers:{Authorization:"Bearer "+i.loggedInUser.CookieWithToken}}).then(function(){},function(){})};n.setVehicleNotStandard=function(n){var r=n.vehicleId,u="/api/Vehicles/"+r;n.defaultVehicle=!1;t.put(u,n,{headers:{Authorization:"Bearer "+i.loggedInUser.CookieWithToken}}).then(function(){},function(){})}});app.controller("addVehiclesController",function(n,t,i){n.addNewVehicleJsAction=function(){n.vehicleAddedSuccessfully=Boolean(JSON.parse(!1));var r=n.VehicleMake,u=n.VehiclePlateNumber,f={Make:r,PlateNumber:u,active:!0};t.post("/api/Vehicles/",f,{headers:{Authorization:"Bearer "+i.loggedInUser.CookieWithToken}}).then(function(){n.vehicleAddedSuccessfully=Boolean(JSON.parse(!0))},function(){})}});app.controller("supportController",function(n){n.messages=[];var t=(new signalR.HubConnectionBuilder).withUrl("/chatHub").build();t.start();n.send=function(){console.log("knapen");var i=new Date,r=i.getHours()+":"+i.getMinutes()+":"+i.getSeconds();t.invoke("SendMessage",n.user.name,n.user.message,r)};t.on("RecieveMessage",function(t,i,r){var u={name:t,message:i,time:r};n.messages.push(u);n.$apply()})});app.controller("rapportController",function(n,t,i,r){t.get("/api/Vehicles/",{headers:{Authorization:"Bearer "+i.loggedInUser.CookieWithToken}}).then(function(t){n.getAvailableVehicles=t.data.availableVehicles},function(){});n.createPdfJsAction=function(){let i={LicensePlate:n.selectVehicle,DateTimeStart:n.DateTimeStartReport,DateTimeStop:n.DateTimeStopReport};t.post("/api/pdf",i).then(function(){r.open("/pdf/"+n.selectVehicle+".pdf","_blank")})};n.createReportJsAction=function(){let i={LicensePlate:n.selectVehicle,DateTimeStart:n.DateTimeStartReport,DateTimeStop:n.DateTimeStopReport};t.post("/api/rapport",i).then(function(t){n.data=t.data;console.log(t);n.labels=["0-20km","21-50km","51-200km"];n.options={legend:{display:!0,position:"bottom"},tooltipEvents:[],showTooltips:!0,tooltipCaretSize:0,onAnimationComplete:function(){this.showTooltip(this.segments,!0)}}})}});